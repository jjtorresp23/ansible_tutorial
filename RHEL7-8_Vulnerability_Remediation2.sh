/usr/bin/echo "### Add the following lines to the /etc/audit/audit.rules file: -w /var/log/sudo.log -p wa -k actions 2." >> /tmp/RemediationLog/RemediationLog.out
/usr/bin/cp /etc/audit/rules.d/audit.rules /tmp/RemediationLog/
/usr/bin/echo "Old setting for /etc/audit/audit.rules" >> /tmp/RemediationLog/RemediationLog.out
/usr/bin/ls -l /etc/audit/rules.d/audit.rules >> /tmp/RemediationLog/RemediationLog.out
/usr/bin/echo "-w /var/log/sudo.log -p wa -k actions 2" >> /etc/audit/rules.d/audit.rules
#Execute the following command to restart auditd # pkill -HUP -P 1 auditd
/usr/sbin/service auditd restart
/usr/bin/cp /etc/sudoers /tmp/RemediationLog/sudoers-addinglog
/usr/bin/sed -i '/# Defaults specification/a\
Defaults logfile=/var/log/sudo.log' /etc/sudoers

/usr/bin/perl -pi.back.sec.remediation -e 's/password sufficient pam_unix.so remember=12/password sufficient pam_unix.so remember=5/g;' /etc/pam.d/system-auth
/usr/bin/perl -pi.back.sec.remediation -e 's/password sufficient pam_unix.so remember=12/password sufficient pam_unix.so remember=5/g;' /etc/pam.d/password-auth

/usr/bin/cp /etc/security/pwquality.conf /tmp/RemediationLog/pwquality.conf_NewLimits
/usr/bin/sed -i '/# minlen =/a\
minlen = 14' /etc/security/pwquality.conf
/usr/bin/sed -i '/# dcredit =/a\
dcredit = -1' /etc/security/pwquality.conf
/usr/bin/sed -i '/# ucredit =/a\
ucredit = -1' /etc/security/pwquality.conf
/usr/bin/sed -i '/# ocredit =/a\
ocredit = -1' /etc/security/pwquality.conf
/usr/bin/sed -i '/# lcredit =/a\
lcredit = -1' /etc/security/pwquality.conf
#/usr/bin/sed -i '/# retry =/a\
#retry = 3' /etc/security/pwquality.conf
/usr/bin/echo "retry = 3" >> /etc/security/pwquality.conf

/usr/bin/cp /etc/ssh/sshd_config /tmp/RemediationLog/sshd_config_Protocol
/usr/bin/echo "Protocol 2" >> /etc/ssh/sshd_config
/usr/bin/systemctl restart sshd
exit
