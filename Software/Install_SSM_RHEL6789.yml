---

- name: Installing SSM..
  hosts: all
  become: yes
  tasks:

  - name: Uploading SSM Package....
    copy:
      src: /home/svcans/SW/SSM/amazon-ssm-agent.rpm
      dest: /tmp/amazon-ssm-agent.rpm
      owner: root
      group: root
      mode: 0755
      remote_src: false

  - name: Installing SSM...
    shell:
         "yum install -y /tmp/amazon-ssm-agent.rpm"

  - name: Stopping SSM Service..
    shell:
         "systemctl stop amazon-ssm-agent"

  - name: Registeiring Instance on SSM Console...
    shell:
         "echo 'yes' |sudo -E amazon-ssm-agent -register -code 'U4MtvVB75wKQHzn9hWHi' -id 'c77740f5-3ad5-4805-8771-6280d349f3aa' -region 'us-east-1'"

  - name: Starting SSM...
    shell:
         "systemctl start amazon-ssm-agent"

  - name: Removing Temporary Files..
    ansible.builtin.file:
      state: absent
      path: /tmp/amazon-ssm-agent.rpm
